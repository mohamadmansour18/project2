<?php

namespace App\Helpers;

class ArabicText
{
    public static function normalize(?string $text): string
    {
        if(!$text)
        {
            return '';
        }

        //ุชุญููู ุงูุงุญุฑู ุงููุจูุฑุฉ ุงูู ุงุญุฑู ุตุบูุฑุฉ
        $t = mb_strtolower($text , 'UTF-8');

        //ุงูุบุงุก ุชุดููู ุงูุญุฑูุงุช ูุซู ูุชุญุฉ ุงู ุถูุฉ ุงู ูุณุฑุฉ ... ุงูุฎ ูู ุงููุต
        $t = preg_replace('/[\x{0610}-\x{061A}\x{064B}-\x{065F}\x{0670}\x{06D6}-\x{06ED}]/u', '', $t);

        //ุญู ูุดููุฉ ุญุฑู ุงูุงูู
        $t = $t = preg_replace('/[ุฃุฅุขูฑ]/u', 'ุง', $t);

        //ูุญุฐู ุงูุญุฑูู ุงููุณุชุฎุฏูุฉ ูู ุงูุชูุทูุท ูุซู : ุณูููุงู -> ุณูุงู
        $t = $t = preg_replace('/\x{0640}/u', '', $t);

        //ูุณุชุจุฏู ุญุฑู ุงูุงูู ุงูููุตูุฑุฉ ุจูุงุก
        $t = preg_replace('/[ู]/u', 'ู', $t);

        //ุงุณุชุจุฏุงู ุงู ูุญุฑู ูุงููุชูู ุงูู ุงุญุฑู ุงููุบุฉ ุงูุนุฑุจูุฉ ุงู ุงูุงุฑูุงู ุงู ุงูุงุญุฑู ุงูุงููููุฒูุฉ ุงูุตุบูุฑุฉ ุงู (ูุณุงูุฉ - ุชุงุจ - ุณุทุฑ ุฌุฏูุฏ) ููู ุจุงุณุชุจุฏุงูู ุจูุณุงูุฉ
        $t = preg_replace('/[^\p{Arabic}0-9a-z\s]/u', ' ', $t);

        //ุถุจุท ุงููุงุฑุบุงุช ุงููุชูุฑุฑุฉ ุงูู ูุฑุงุบ ูุงุญุฏ
        $t = preg_replace('/\s+/u', ' ', $t);

        return trim($t);
    }

    //Example
    //Before :
    //$text = "ุฃูููููุง ููุณูููููุง ู ุณูููุงูู! ูุตุทูููุ ูกูขูฃ ABC, Hello ๐";

    //After :
    //$text = "ุงููุง ููุฑุญุจุง ุณูุงู ูุตุทูู 123 abc hello";
}
